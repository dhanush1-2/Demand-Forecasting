# =============================================================================
# DEMAND FORECASTING MLOPS - MAIN CONFIGURATION
# =============================================================================

project:
  name: "demand-forecasting-mlops"
  version: "1.0.0"
  description: "End-to-end MLOps platform for demand forecasting"

# =============================================================================
# DATA CONFIGURATION
# =============================================================================
data:
  raw_path: "data/raw"
  processed_path: "data/processed"
  features_path: "data/features"

  # Raw data file
  raw_file: "demand_forecasting_dataset (1).csv"

  # Processed data file
  processed_file: "cleaned_data.parquet"

  # Features file
  features_file: "features.parquet"

  # Column mappings
  columns:
    date: "date"
    target: "target_demand"
    features:
      - "product_id"
      - "category_id"
      - "store_id"
      - "historical_sales"
      - "price"
      - "promotion_flag"
      - "holiday_flag"
      - "economic_index"

  # Data types
  dtypes:
    date: "datetime64[ns]"
    product_id: "int64"
    category_id: "int64"
    store_id: "int64"
    historical_sales: "int64"
    price: "float64"
    promotion_flag: "int64"
    holiday_flag: "int64"
    economic_index: "float64"
    target_demand: "int64"

# =============================================================================
# FEATURE ENGINEERING CONFIGURATION
# =============================================================================
features:
  # Lag features (days)
  lags: [1, 3, 7, 14, 30]

  # Rolling window features (days)
  rolling_windows: [7, 14, 30]

  # Rolling statistics to compute
  rolling_stats: ["mean", "std", "min", "max"]

  # Time-based features to extract
  time_features:
    - "day_of_week"
    - "day_of_month"
    - "week_of_year"
    - "month"
    - "quarter"
    - "is_weekend"
    - "is_month_start"
    - "is_month_end"

# =============================================================================
# MODEL CONFIGURATION
# =============================================================================
models:
  # Output directory
  output_dir: "models"

  # Train/test split
  test_size: 0.2
  random_state: 42

  # Cross-validation
  cv_folds: 5

  # Prophet configuration
  prophet:
    yearly_seasonality: true
    weekly_seasonality: true
    daily_seasonality: false
    seasonality_mode: "multiplicative"
    changepoint_prior_scale: 0.05

  # XGBoost configuration
  xgboost:
    objective: "reg:squarederror"
    eval_metric: "rmse"
    max_depth: 6
    learning_rate: 0.1
    n_estimators: 100
    early_stopping_rounds: 20

  # LightGBM configuration
  lightgbm:
    objective: "regression"
    metric: "rmse"
    max_depth: 6
    learning_rate: 0.1
    n_estimators: 100
    early_stopping_rounds: 20

  # CatBoost configuration
  catboost:
    loss_function: "RMSE"
    depth: 6
    learning_rate: 0.1
    iterations: 100
    early_stopping_rounds: 20

# =============================================================================
# OPTUNA CONFIGURATION
# =============================================================================
optuna:
  n_trials: 50
  timeout: 3600  # 1 hour max
  direction: "minimize"  # Minimize RMSE

  # Search spaces for each model
  search_spaces:
    xgboost:
      max_depth: [3, 10]
      learning_rate: [0.01, 0.3]
      n_estimators: [50, 300]
      subsample: [0.6, 1.0]
      colsample_bytree: [0.6, 1.0]

    lightgbm:
      max_depth: [3, 10]
      learning_rate: [0.01, 0.3]
      n_estimators: [50, 300]
      subsample: [0.6, 1.0]
      colsample_bytree: [0.6, 1.0]

    catboost:
      depth: [3, 10]
      learning_rate: [0.01, 0.3]
      iterations: [50, 300]

# =============================================================================
# MLFLOW CONFIGURATION
# =============================================================================
mlflow:
  tracking_uri: "mlruns"
  experiment_name: "demand-forecasting"
  registry_uri: "mlruns"

  # Model registry
  registered_model_name: "demand-forecaster"

  # Artifact logging
  log_models: true
  log_datasets: true

# =============================================================================
# API CONFIGURATION
# =============================================================================
api:
  host: "0.0.0.0"
  port: 8000
  reload: true  # For development
  workers: 1

  # Model to serve
  model_name: "demand-forecaster"
  model_stage: "Production"

# =============================================================================
# DASHBOARD CONFIGURATION
# =============================================================================
dashboard:
  host: "0.0.0.0"
  port: 8501

  # Theme
  theme: "light"

  # Refresh interval (seconds)
  refresh_interval: 60

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================
monitoring:
  # Evidently reports output
  reports_dir: "outputs/drift_reports"

  # Drift thresholds
  data_drift_threshold: 0.1
  target_drift_threshold: 0.1

  # Features to monitor
  monitor_features:
    - "price"
    - "historical_sales"
    - "economic_index"
    - "promotion_flag"

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
logging:
  level: "INFO"
  format: "<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>"

  # Log to file
  file:
    path: "logs/app.log"
    rotation: "10 MB"
    retention: "7 days"

# =============================================================================
# PATHS
# =============================================================================
paths:
  data: "data"
  models: "models"
  outputs: "outputs"
  logs: "logs"
  configs: "configs"
